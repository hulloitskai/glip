language: go

go:
  - '1.10'
  - '1.11'
  - tip

git:
  depth: 3

os:
  - osx
  - linux

## Install dependencies and code review tools
before_install:
  # Required for auto-linting Go code.
  - go get -u golang.org/x/lint/golint
    # Required for tests on Linux.
  - if [ "$TRAVIS_OS_NAME" == "linux" ];
    then sudo apt-get install xclip;
    fi

install:
  # Install all sub-packages; include tests.
  - go get -t ./...

script: |
  if [ "$TRAVIS_OS_NAME" == "osx" ];
  then make review-race-v;
  else xvfb-run make review-race-v; # Imitate an display on Linux
  fi

after_success:
  - bash <(curl -s https://codecov.io/bash)
